<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="RV-Toolkit | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />
<link rel="canonical" href="https://runtimeverification.github.io/rv-toolkit-docs/predict/java/quickstart/" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../assets/img/favicon.ico" />

<title>RV-Toolkit | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../index.html"> RV-Toolkit </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/rv-toolkit-docs"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../predict/java/">Welcome!</a>
      <a class="bd-toc-link" href="../../../predict/java/quickstart/"
        >Quickstart</a
      >
      <a class="bd-toc-link" href="../../../predict/java/runningexamples/"
        >Running Examples</a
      >
      <a class="bd-toc-link" href="../../../predict/java/troubleshooting/"
        >Trouble Shooting</a
      >
      <a
        class="bd-toc-link"
        href="https://runtimeverification.com/blog/category/rv-predict/"
        target="_blank"
        >RV-Predict Blog</a
      >
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="introduction markdown-preview"><html><head></head><body><h1 id="quickstart">Quickstart</h1>
<h2 id="prerequisites">Prerequisites</h2>
<p>RV-Predict requires Java Runtime Environment 1.8 or higher.</p>
<h2 id="installation">Installation</h2>
<p>Download the installer from the <a href="https://github.com/runtimeverification/predict/releases" target="_blank" rel="noreferrer noopener">RV-Predict website</a> and execute it with <code>java -jar &lt;installer&gt;</code>, following all instructions. Remember to add the bin directory under the RV-Predict installation directory to your PATH environment variable.</p>
<h2 id="running-rv-predict">Running RV-Predict</h2>
<p>RV-Predict can be run both from the command line, as a drop in replacement for the <code>java</code> command, and as an agent, to ease integration with IDEs and build management tools like Maven.</p>
<p>In the following, we assume <code>${rvPath}</code> is the installation directory for RV-Predict.</p>
<p>Moreover, we will use <code>${rvOptions}</code> to refer to the <a href="#rv-predict-options">RV-Predict options</a> used for controlling the RV-Predict tool, and <code>${jvmOptions}</code> to refer to additional <a href="#jvm-options">JVM options</a> which can impact the overall performance of the tool, both of them detailed below. Note that for simpler examples, these options can be omitted altogether.</p>
<h2 id="on-the-command-line">on the command line</h2>
<p>RV-Predict is invoked as follows:</p>
<pre><code>rv-predict ${rvOptions} [--] ${jvmOptions} class [args...]
    (to predict races in a class)
or  rv-predict ${rvOptions} [--] ${jvmOptions} -jar jarfile [args...]
    (to predict races in an executable jar file)
</code></pre>
<p>Whenever it might cause confusion, the optional <code>--</code> can be used as a terminator for the RV-Predict options.</p>
<p>The <code>rv-predict</code> script is itself just a wrapper for the Java command:</p>
<pre><code>java -jar ${rvPath}/lib/rv-predict.jar
</code></pre>
<p>and they can be used interchangeably. The benefit of the script is that if <code>${rvPath}/bin</code> is added to the environment <code>PATH</code>, <code>${rvPath}</code> does not need to be mentioned at each tool invocation anymore.</p>
<h2 id="as-an-agent">As an agent</h2>
<p>Running RV-Predict as an agent along with your Java application simply requires adding the <code>-javaagent:${rvPath}/lib/rv-predict.jar</code> option to your Java command line. Passing options to the agent can be done as standard for agents: using <code>-javaagent:${rvPath}/lib/rv-predict.jar="${rvOptions}"</code>.</p>
<h3 id="integration-with-maven">Integration with Maven</h3>
<p>For Maven-based projects which have tests, one can simply run <code>mvn test</code>, after modifying the individual project's <code>pom.xml</code> to have an element similar to the following:</p>
<pre><code>&lt;build&gt;
    &lt;plugins&gt;
        ...
        &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
        &lt;version&gt;${surefire-version}&lt;/version&gt;
        &lt;configuration&gt;
            &lt;argLine&gt; ${jvmOptions} -javaagent:${rvPath}/lib/rv-predict.jar="${rvOptions}" &lt;/argLine&gt;
        &lt;/configuration&gt;
        &lt;/plugin&gt;
    ...
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
<p>Replace <code>${surefire-version}</code> with the exact surefire plugin version used by the project (e.g., <code>2.16</code>).</p>
<h3 id="integration-with-ides">Integration with IDEs</h3>
<p><strong>Generic instructions</strong></p>
<p>Same options as above need to be added to the VM options of your IDE's Run/Debug Configurations.</p>
<p><strong>Eclipse</strong></p>
<p>From the menu select <strong>Run</strong> -&gt; <strong>Run Configurations</strong> -&gt; (then you select the configuration that you are running) -&gt; select <strong>Arguments</strong> tab -&gt; enter into the <strong>VM arguments</strong> field</p>
<ul>
<li><code>${jvmOptions} -javaagent:${rvPath}/lib/rv-predict.jar="${rvOptions}"</code></li>
</ul>
<p><strong>IntelliJ IDEA</strong></p>
<p>From the menu select <strong>Run</strong> -&gt; <strong>Edit Configurations</strong> -&gt; (then you select the configuration that you are running) -&gt; enter into the <strong>VM options</strong> field</p>
<ul>
<li><code>${jvmOptions} -javaagent:${rvPath}/lib/rv-predict.jar="${rvOptions}"</code></li>
</ul>
<h3 id="using-rv-predict-for-all-java-apps">Using RV-Predict for all Java apps</h3>
<p>If one wants to run RV-Predict for any invocation of the <code>java</code> tool, one can simply update the environment variable <code>JAVA_TOOL_OPTIONS</code> to include the line</p>
<ul>
<li><code>${jvmOptions} -javaagent:${rvPath}/lib/rv-predict.jar="${rvOptions}"</code></li>
</ul>
<h1 id="rv-predict-options">RV-Predict options</h1>
<p>The RV-Predict options are used for controlling the execution of RV-Predict either in agent mode or in command-line mode. The list of common options can be obtained by using the <code>-h</code> or <code>--help</code> option when invoking RV-Predict:</p>
<pre><code>rv-predict -h

Usage: rv-predict [rv_predict_options] [--] [java_options] &lt;java_command_line&gt;
  Common options (use -h -v for a complete list):

      --base-log-dir     The name of the base directory where RV-Predict
                         creates log directories
                         Default: /tmp

      --log-dirname      The name of the log directory where RV-Predict
                         stores log files

      --include          Comma separated list of packages to include

      --exclude          Comma separated list of packages to exclude

      --window           Window size (must be &gt;= 64)
                         Default: 1000

      --suppress         Suppress race reports on the fields that match
                         the given (comma-separated) list of regular
                         expressions
                         Default:

  -v, --verbose          Generate more verbose output

      --version          Print product version and exit

  -h, --help             Print help info
</code></pre>
<p>Explanation:</p>
<ul>
<li>the <code>--offline</code> option tells RV-Predict to store the logged execution trace on disk and only run the prediction algorithm after the application terminates.</li>
<li>the <code>--base-log-dir &lt;dir&gt;</code> option specifies the path of the directory where RV-Predict creates its log directories. This option defaults to the current temporary directory on your platform (usually set with the environment variable TMPDIR in Linux/Unix, or TMP or TEMP in Windows).</li>
<li>the <code>--log-dirname &lt;dirname&gt;</code> option specifies the name of the log directory where RV-Predict stores log files such as traces and metadatas. When this option is not specified, RV-Predict will create and use a fresh temporary directory.</li>
<li>the <code>--include</code> option tells RV-Predict to include the given packages in instrumentation; this option takes precedence over the following <code>--exclude</code> option.</li>
<li>the <code>--exclude</code> option tells RV-Predict to exclude the given packages from instrumentation.</li>
<li>the <code>--window &lt;size&gt;</code> (default: <code>1000</code>) option tells RV-Predict to find races between events with the largest distance of <code>&lt;size&gt;</code> in the logged trace. The larger the <code>&lt;size&gt;</code> is, the more races are expected to be detected, and the more time RV-Predict will take.</li>
<li>the <code>--suppress</code> option tells RV-Predict to suppress race reports on the fields that match the given regular expression patterns; only used when the user is absolutely certain that the data race to be suppressed is benign.</li>
<li><code>--</code> can be used as a terminator for the RV-Predict options.</li>
</ul>
<h2 id="advanced-options">Advanced options</h2>
<p>The complete list of RV-Predict options can be obtained by combining the <code>-h</code> and <code>-v</code> options:</p>
<pre><code>rv-predict -h -v
</code></pre>
<p>As this list of advanced options is continuously evolving, we only list the more common ones here. Please feel free to contact us in case the explanations displayed by invoking the tool are not sufficient:</p>
<ul>
<li>the <code>--log</code> option tells RV-Predict to log the execution trace but skip the prediction phase.</li>
<li>the <code>--predict &lt;dir&gt;</code> option tells RV-Predict to skip the logging phase, using the logged trace from the <code>&lt;dir&gt;</code> directory to run the prediction algorithms. When using this option, all non-<a href="#rv-predict-options">RV-Predict options</a> will be disregarded.</li>
<li>the <code>--profile</code> option instructs RV-Predict to run in the profiling mode which does not perform any deep analysis. It is commonly used to estimate the number and distribution of events generated from the instrumented classes.</li>
<li>the <code>--no-stacks</code> option tells RV-Predict to not record call stack events that are used to compute stack traces in the race report.</li>
</ul>
<h2 id="enhancing-prediction-power">Enhancing prediction power</h2>
<p>By default, RV-Predict tries to keep a good balance between efficiency and prediction power. Nevertheless, while the default settings were engineered to work for most common cases, there might be cases where user input could improve the prediction process. We provide several options for advanced users to tune RV-Predict:</p>
<ol>
<li>Window size. For efficiency reasons, RV-Predict splits the execution trace into segments (called windows) of a specified size. The default window size is <code>1000</code>. Users can alter this size using the <code>--window</code> option, with the intuition that a larger size provides better coverage at the expense of increasing the analysis time.</li>
<li>Excluding packages. To allow better control over the efficiency, RV-Predict provides the option <code>--exclude</code> to remove certain packages from logging. This option takes a list of package patterns prefixes separated by <code>,</code> and excludes from logging any class matched by one of the patterns. The patterns can use <code>*</code> to match any sequence of characters. Moreover, <code>*</code> is automatically assumed at the end of each pattern (to make sure inner classes are excluded together with their parent). Please note that excluding packages might affect precision, as events from non-logged packages might prevent certain race conditions from occurring. Note: in <code>bash</code>-like enviroments, the <code>$</code> character must be escaped as it is used by the shell to introduce environment variables.</li>
<li>Including packages. To give more flexibility to selecting which packages to include and exclude, RV-Predict also provides the <code>--include</code> option which is similar to the <code>--exclude</code> option (comma separated list of package patterns), but opposite in effect.</li>
</ol>
<h1 id="jvm-options">JVM options</h1>
<p>As RV-Predict instruments the code at runtime and records sequences of events in the JVM memory, running RV-Predict on larger applications might require adjusting the memory limits of the JVM. For example, here are the initial options passed by our helper script when invoking RV-Predict:</p>
<ul>
<li><code>-Xss4m</code> sets the thread stack size of the JVM to be 4MB,</li>
<li><code>-Xms64m</code> sets the initial heap size to be 64MB</li>
<li><code>-Xmx1g</code> sets the maximum heap size to be 1G</li>
</ul>
<p>In addition, we strongly recommend adding the <code>-XX:hashCode=1</code> option if running RV-Predict on larger projects; this significantly reduces the possibility of false positives due to identity hash code collision.</p>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#quickstart" class="bd-toc-link">Quickstart</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#prerequisites"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Prerequisites
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#installation"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Installation
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#running-rv-predict"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Running RV-Predict
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#on-the-command-line"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                on the command line
              </a></div><details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#as-an-agent" class="bd-toc-link">As an agent</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#integration-with-maven"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Integration with Maven
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#integration-with-ides"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Integration with IDEs
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#using-rv-predict-for-all-java-apps"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Using RV-Predict for all Java apps
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#rv-predict-options" class="bd-toc-link">RV-Predict options</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#advanced-options"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Advanced options
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#enhancing-prediction-power"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Enhancing prediction power
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#jvm-options"
                class="bd-toc-link"
                style="padding-left: 0px;;"
              >
                JVM options
              </a></div>
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://maps.app.goo.gl/8YhKozfmZtgzQBsH7" target="_blank"
            >202 S Broadway Ave #31, Urbana, IL</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 pl-0 text-md-right">
        <p class="copyright">2024 Â© all rights reserved</p>
        <span class="copyright"
          ><a href="https://runtimeverification.com/privacy-policy"
            >privacy policy</a
          >
          |
          <a href="https://runtimeverification.com/terms-of-use"
            >terms of use</a
          ></span
        >
      </div>
    </div>
  </div>
</footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../assets/js/index.js"></script>
  </body>
</html>
